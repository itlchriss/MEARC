# MEAning Representation Compiler

A meaning representation (MR) compiler translating meaning representation to JML, with contextual information and semantic interpretations (SI) of predicates

## Keywords
Formal method, Design by Contract, Java Modeling Language

### Installation
1. ccg2lambda installation. The following instruction is for the version released on 04-10-2017.
	i. Download the source code of ccg2lambda from [here](https://github.com/mynlp/ccg2lambda/archive/refs/tags/eacl2017.tar.gz).
2. Installing the Python 3.9 or above
3. Setting up python virtual environment and installing required Python modules
	```
	python -m venv py3
	source py3/bin/activate
	pip install beautifulsoup4 lxml pyyaml javalang simplejson -I nltk==3.0.5
	```
	- Following commands are for nltk support
	```
	python -c "import nltk; nltk.download('punkt'); nltk.download('wordnet')"
	```
	- Note: By running the above python script, two zip files should be downloaded and unzip to the ~/nltk_data. In some cases, the files are not decompressed. If so, please access the nltk_data folder and manually decompress them.
	- Note: For OSX, you may encounter SSL problem. Try running
	``` 
	bash /Applications/Python\ 3.9/Install\ Certificates.command
	```
3. Following the [ccg2lambda installation instructions](https://github.com/mynlp/ccg2lambda) to install the NLP tool
4. Perform the changes to ccg2lambda by copying the files in the [ccg2lambda_changes](./ccg2lambda/changes/src) folder to the corresponding ccg2lambda folders
5. Create a *build* folder under ccg2lambda, and copy the *ccg2lambda_changes/run.sh* to the newly created *build* folder.
6. Following the [openjml installation instructions](https://www.openjml.org/downloads/), please install the [0.17.0-alpha-15 version](https://github.com/OpenJML/OpenJML/releases/tag/0.17.0-alpha-15).

## Building the compiler
```
cd ./c
make
```
If you need to debug your SI template/translation rules, you can check with the c/Makefile to turn on necessary debug flags

## Running the tool
1. Set the enviroment variables of 
   	- **PYTHON** - The python command to use with the required modules installed
   	- **CANDC** - The C&C parser **bin** path. This should be installed along with the ccg2lambda tool
   	- **CCG2LAMBDA** - The root path of the installed ccg2lambda tool
2. Run the test data. This will run all the test under the folder datasets/pattern. You can observe the results and check the resulting JMLs in the datasets/results.
   ```python
   python scripts/run_tests.py
   ```
3. For your own cases, write pre/postconditions to a java program, such as the following Sort.java program
   ```java
	public class Sort {
		//@ requires (*The input array should not be null*);
		//@ ensures (*The input array should be sorted in descending order*);
		public static void sort(int[] arr) {
			...
		}
	}
   ```
4. Use the mearc script to run the case,
	```
	python mearc ./mearc.config [your_java_source_code_file]
	```
5. Automatically check the code with the OpenJML, you can use this command,
	```
	openjml --esc [your_java_source_code_file] --specs-path [the_generated_JML_spec_path]
	```

## Future improvements
- Adding a script to parse the yml generated by preprocessor and bridges the ccg2lambda
